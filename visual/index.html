<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <script>
    const socket = io("https://cell-project.onrender.com"); // ⚡ 必须加上 Render URL
    let sensorData = { x: 0, y: 0 };

    socket.on("motion", (data) => {
      sensorData.x = data.x;
      sensorData.y = data.y;
    });

    // ================== 可直接粘贴你的视觉逻辑 ==================
    const CONFIG = {
      cellCount: 15,
      otherScaleMin: 15,
      otherScaleMax: 35,
      otherRingCountMin: 10,
      otherRingCountMax: 47,
      otherStrokeAlphaMin: 15,
      otherStrokeAlphaMax: 60,
      playerSaturation: 1.5,
      playerAlpha: 300,
      rocketSpawnRate: 0.05,
      rocketSpeed: 8,
      noiseDensity: 20000,
      noiseAlpha: 100,
      gridSize: 50,
      gridColor: 200,
      gridAlpha: 180,
      showGridLabels: true,
      gridTextColor: 120,
      showDataText: true
    };

    let cells = [], rockets = [], playerCell;

    function setup() {
      createCanvas(windowWidth, windowHeight);
      for (let i = 0; i < CONFIG.cellCount; i++)
        cells.push(new BioCell(random(width), random(height), false));
      playerCell = new BioCell(width/2, height/2, true);
      textFont('Courier New');
      textStyle(BOLD);
    }

    function draw() {
      background(240);
      drawGridSystem();
      drawNoisyBackground();
      playerCell.applySensorForce(sensorData.x, sensorData.y);
      playerCell.update();
      playerCell.display();
      playerCell.checkEdges();

      for (let c of cells) {
        c.autonomousMove();
        c.update();
        c.display();
        c.checkEdges();
        if (playerCell.intersects(c)) playerCell.resolveCollision(c);
        for (let other of cells) if (c !== other && c.intersects(other)) c.resolveCollision(other);
      }

      manageRockets();
      drawUI();
    }

    // ================== 你之前写的 rocket 和 BioCell 类都可以完整粘贴 ==================
    // ⚡ 确保这些类没有 io() 调用，它们只操作 sensorData 和 p5 绘制
    // 这里省略，直接粘贴你之前 visual/index.html 的 Rocket 和 BioCell 代码即可

    function windowResized() { resizeCanvas(windowWidth, windowHeight); }
  </script>
</body>
</html>
